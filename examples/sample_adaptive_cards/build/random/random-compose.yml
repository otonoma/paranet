services:
  random-mysql:
    image: mysql:8
    environment:
      MYSQL_ROOT_PASSWORD: admin
      MYSQL_DATABASE: paraflow
    networks:
      - paranet
    healthcheck:
      test: /usr/bin/mysql --user=root --password=admin --execute "SHOW DATABASES;"
      interval: 5s
      timeout: 20s
      retries: 10
  paraflow:
    image: 214730072331.dkr.ecr.us-west-2.amazonaws.com/grokit/paraflow:testdrive-v1.32.0
    environment:
      OMICRON_LOCAL: "1"
      OMICRON_LOCAL_DYNAMODB: http://dynamodb:8000
      AWS_ACCESS_KEY_ID: x
      AWS_SECRET_ACCESS_KEY: x
      PARAFLOW_DB_HOST: random-mysql:3306
      PARAFLOW_PARANET_HOST: http://172.18.0.6:3131
      PARAFLOW_PARANET_ACTOR_ID_OVERRIDE: random@1.0.0
      PARAFLOW_MOCKENV: "1"
      RUST_LOG: debug,hyper::proto=info,h2=info
    command:
      - /usr/local/bin/paraflow
      - /paraflow/data/debug.paraflow
      - --schema
      - /paraflow/data/debug.sql
      - --register
      - --register-base
      - --debugger
      - --log-net
    depends_on:
      random-mysql:
        condition: service_healthy
    extra_hosts:
      - host.docker.internal:host-gateway
    ports:
      - "3030"
    links:
      - random-mysql
    restart: always
    networks:
      - paranet
    labels:
      - ai.paranet.paraflow.actor_id=random@1.0.0
volumes:
  exclude: {}
networks:
  paranet:
    name: testdrive_default
    external: true
