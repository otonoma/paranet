name: Production Release

on:
  workflow_dispatch:

permissions:
  id-token: write
  contents: read
  packages: write

jobs:
  set-date:
    name: Set Date
    runs-on: ubuntu-latest
    outputs:
      DATE_TAG: ${{ steps.date_tag.outputs.DATE_TAG }}
    steps:
      - name: Date tag
        id: date_tag
        run: |
          echo "DATE_TAG=$(date +'%Y.%m.%d')" >> $GITHUB_OUTPUT

  retag-prod:
    name: Retag to Production
    runs-on: ubuntu-latest
    needs: [set-date]
    steps:
      - name: Call Reusable Retag
        uses: ./.github/workflows/releaseTemplate.yaml
        with:
          TARGET_TAG: "staging"
          TAGS: "prod-${{ needs.set-date.outputs.DATE_TAG }} prod"
        # secrets: inherit
