"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[804],{4388:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>d});var a=n(4848),s=n(8453);const r={id:"top-level",title:"Top Level",sidebar_position:4},l="Top Level",i={id:"paraflow/top-level",title:"Top Level",description:"Events",source:"@site/paranet/paraflow/top_level.md",sourceDirName:"paraflow",slug:"/paraflow/top-level",permalink:"/paranet/paraflow/top-level",draft:!1,unlisted:!1,editUrl:"https://github.com/your-org/your-project/edit/main/paranet/paraflow/top_level.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{id:"top-level",title:"Top Level",sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Language Basics",permalink:"/paranet/paraflow/language-basics"},next:{title:"Variables",permalink:"/paranet/paraflow/variables"}},o={},d=[{value:"Events",id:"events",level:2},{value:"Parameters",id:"parameters",level:2},{value:"Table Parameters",id:"table-parameters",level:3},{value:"Event Body",id:"event-body",level:2},{value:"Skill Decorators",id:"skill-decorators",level:2},{value:"Rules",id:"rules",level:2},{value:"Goal Pattern",id:"goal-pattern",level:3},{value:"Rule Body",id:"rule-body",level:3},{value:"Paraflow Tasks",id:"paraflow-tasks",level:2},{value:"Service APIs",id:"service-apis",level:2},{value:"PNCP Task",id:"pncp-task",level:2},{value:"Skill Requests",id:"skill-requests",level:3},{value:"Procedures and Functions",id:"procedures-and-functions",level:2}];function c(e){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"top-level",children:"Top Level"})}),"\n",(0,a.jsx)(t.h2,{id:"events",children:"Events"}),"\n",(0,a.jsx)(t.p,{children:"Events describe what to do when some external event occurs from the environment. The event declaration has a list of parameters that are expected for the event and a statement body that is executed when the event is triggered."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:'<event> :=\n  "event" [ <system-event> ] <identifier> <parameter-list>\n  <event-stmt-block>\n'})}),"\n",(0,a.jsx)(t.p,{children:"For example,"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"event newRequest($uid string) {\n  !StartRequest($id);\n}\n"})}),"\n",(0,a.jsx)(t.h2,{id:"parameters",children:"Parameters"}),"\n",(0,a.jsx)(t.p,{children:"The parameter list is a comma-separated list of parameter definitions, which include the name and type of the parameter."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:'<parameter-list> := "(" <parameter> { "," <parameter> } ")"\n<parameter> := <$identifier> [ "optional" ] <parameter-type>\n<parameter-type> :=\n  <simple-type> |\n  <table-type> |\n  "json"\n\n<simple-type> :=\n  "int" |\n  "double" |\n  "string"\n'})}),"\n",(0,a.jsxs)(t.p,{children:["When an event is received, the event data is matched against the parameter list of the event declaration. It is an error if the event data does not include any parameter, or if the value is null unless the parameter is declared with the ",(0,a.jsx)(t.code,{children:"optional"})," keyword."]}),"\n",(0,a.jsxs)(t.p,{children:["Parameters declared as type ",(0,a.jsx)(t.code,{children:"json"})," will match any scalar or object value; however, the parameter value will be assigned the string representation of that value. Where appropriate, the parameter may be used with the ",(0,a.jsx)(t.code,{children:"ParseJson"})," function. See the Objects section for details."]}),"\n",(0,a.jsx)(t.h3,{id:"table-parameters",children:"Table Parameters"}),"\n",(0,a.jsx)(t.p,{children:"Event parameters declared as tables will match event data represented as an array of objects."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:'<table-type> := "table" "(" <table-column> { "," <table-column> } ")"\n<table-column> := <identifier> [ "optional" ] <simple-type>\n'})}),"\n",(0,a.jsxs)(t.p,{children:["Each element of the event data array must match the table column definitions. It is an error if any element does not include any column or if the value is null unless the column is declared with the ",(0,a.jsx)(t.code,{children:"optional"})," keyword."]}),"\n",(0,a.jsx)(t.h2,{id:"event-body",children:"Event Body"}),"\n",(0,a.jsx)(t.p,{children:"The event body consists of a list of statements."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:'<event-stmt-block> := "{" <event-statement> { <event-statement> } "}"\n<event-statement> :=\n  <let-statement> |\n  <procedure-call> |\n  <if-statement> |\n  <with-statement> |\n  <loop-statement> |\n  <transaction-statement> |\n  <update-statement> |\n  <new-goal-statement> |\n  <update-goal-statement> |\n  <return-statement> |\n  <audit-statement> |\n  <log-statement>\n'})}),"\n",(0,a.jsx)(t.h2,{id:"skill-decorators",children:"Skill Decorators"}),"\n",(0,a.jsx)(t.p,{children:"Events preceded by a skill decoration correspond to a Paranet skill provided by the Paraflow program. The descriptor defines the subject and action of the implemented skill."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"%skill(subject=messaging, action=send)\nevent newSendMessage($message string, $conversation string, $requester string) {\n\u22ee\n}\n"})}),"\n",(0,a.jsx)(t.p,{children:"The skill decoration does two things:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"The Paraflow code is registered as a provider of the skill on the Paranet."}),"\n",(0,a.jsx)(t.li,{children:"The Paraflow event is registered as the callback that is invoked whenever a new request is matched to this program."}),"\n"]}),"\n",(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.code,{children:"conversation"})," and ",(0,a.jsx)(t.code,{children:"requester"})," parameters are predefined and assigned the unique conversation ID and requesting actor ID of the corresponding skill request. All other event parameters are registered as inputs for the skill."]}),"\n",(0,a.jsx)(t.h2,{id:"rules",children:"Rules"}),"\n",(0,a.jsx)(t.p,{children:"Rules describe how a goal can be achieved by decomposition into subgoals. The rule declaration has a goal pattern that describes what goals the rule can be applied to and a rule body that describes how to achieve that goal in terms of subgoals."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:'<rule> := "rule" <goal-pattern> <rule-body>\n'})}),"\n",(0,a.jsx)(t.p,{children:"For example,"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"rule !DoAthenB($id) {\n  !DoA($id);\n  !DoB($id);\n}\n"})}),"\n",(0,a.jsx)(t.p,{children:"Rules may depend on data, but cannot change or create new data. Although subgoals may have data and time-order dependencies, the rule expansion into subgoals happens at once."}),"\n",(0,a.jsx)(t.h3,{id:"goal-pattern",children:"Goal Pattern"}),"\n",(0,a.jsx)(t.p,{children:"The goal pattern describes:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"The goals to which it can be applied,"}),"\n",(0,a.jsx)(t.li,{children:"Zero or more constraint conditions, and"}),"\n",(0,a.jsx)(t.li,{children:"The data context captured for use in the rule body"}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"Goal patterns have the form:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:'<goal-pattern> := <goal-term> { "," <goal-term> | <data-term> }\n<goal-term> :=\n    <goal> "(" <pattern-binding> {"," <pattern-binding>} ")"\n<data-term> :=\n    <table-name> "(" <pattern-binding> {"," <pattern-binding>} ")"\n'})}),"\n",(0,a.jsx)(t.p,{children:"For example,"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:'!processOrder($id), order(id == $id, agent == "ext", $email)\n'})}),"\n",(0,a.jsxs)(t.p,{children:["This head matches ",(0,a.jsx)(t.code,{children:"!processOrder"})," goals if there exists a row in the order table where the ",(0,a.jsx)(t.code,{children:"id"})," column is equal to the goal\u2019s ",(0,a.jsx)(t.code,{children:"$id"})," parameter and the ",(0,a.jsx)(t.code,{children:"agent"}),' column is equal to "ext". Further, it captures the value of the ',(0,a.jsx)(t.code,{children:"email"})," column of that row in a local variable ",(0,a.jsx)(t.code,{children:"$email"})," that can be used within the rule body."]}),"\n",(0,a.jsx)(t.p,{children:"The pattern binding syntax is described in detail in the Binding section."}),"\n",(0,a.jsx)(t.h3,{id:"rule-body",children:"Rule Body"}),"\n",(0,a.jsx)(t.p,{children:"The rule body contains one or more statements that are executed to generate the subgoals that need to be achieved in order to achieve the matched head goal. The head goal is complete when all the generated subgoals are complete. If any subgoal fails, then the head goal fails."}),"\n",(0,a.jsx)(t.p,{children:"The principal statement of the rule body is the goal statement, which consists of a single goal expression:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:'<goal-statement> := <goal-sequence> {"," <goal-sequence>} ";"\n<goal-sequence> := <goal-primary> {"++" <goal-primary>}\n<goal-primary> := <goal-instance> | <goal-enablement>\n<goal-instance> := <goal> <call-bindings> [ "?" ] [ <after-clause> ]\n'})}),"\n",(0,a.jsxs)(t.p,{children:["Goals instances separated by the ",(0,a.jsx)(t.code,{children:","})," symbol have no ordering dependencies, and the planner will seek to achieve such instances independently and concurrently. Instances separated by ",(0,a.jsx)(t.code,{children:"++"})," or in separate goal statements (separated by the semicolon) have an explicit ordering dependency, and the planner will not seek to achieve any such instance until all preceding instances are complete."]}),"\n",(0,a.jsx)(t.p,{children:"For example,"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"!shipPO(id -> $po), !invoicePO(id -> $po);\n"})}),"\n",(0,a.jsx)(t.p,{children:"This example creates two subgoals that have no ordering dependencies."}),"\n",(0,a.jsx)(t.p,{children:"Other statements such as control flow and loops may also be used in rule bodies. The full list of allowed statements is:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:'<rule-stmt-block> := "{" <rule-statement> { <rule-statement> } "}"\n<rule-statement> :=\n  <simple-let-statement> |\n  <goal-statement> |\n  <if-statement> |\n  <with-statement> |\n  <loop-statement> |\n  <log-statement>\n'})}),"\n",(0,a.jsx)(t.h2,{id:"paraflow-tasks",children:"Paraflow Tasks"}),"\n",(0,a.jsx)(t.p,{children:"One of two types of tasks, the Paraflow task describes how to achieve matching goals as code. Like rules, the task declaration has a goal pattern to describe what goals it applies to. Unlike rules, the task body describes how to achieve the goal procedurally. When the planner matches a specific goal instance to a task, the task body will be executed. The goal will be considered complete once the task body has been executed."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:'<paraflow-task> : =\n  "task" <goal-pattern> [ <cost-clause> ] [ "on" <expression> ] \n  <task-stmt-block>\n  [ <catch-block> ]\n'})}),"\n",(0,a.jsx)(t.p,{children:"Goal patterns are described in detail in the Rules section. The task body consists of a list of statements to execute."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:'<task-stmt-block> := "{" <task-statement> { <task-statement> } "}"\n<task-statement> :=\n  <let-statement> |\n  <rpc-statement> |\n  <procedure-call> |\n  <pncp-statement> |\n  <if-statement> |\n  <with-statement> |\n  <loop-statement> |\n  <transaction-statement> |\n  <update-statement> |\n  <new-goal-statement> |\n  <update-goal-statement> |\n  <return-statement> |\n  <retry-statement> |\n  <audit-statement> |\n  <log-statement>\n'})}),"\n",(0,a.jsx)(t.h2,{id:"service-apis",children:"Service APIs"}),"\n",(0,a.jsxs)(t.p,{children:["A Paraflow task may be used to make calls to any external service that provides a GraphQL interface. The ",(0,a.jsx)(t.code,{children:"on"})," clause of the Paraflow task declaration provides the default URL of the endpoint providing the GraphQL service. The endpoint may also be overridden in individual calls to the service via the ",(0,a.jsx)(t.code,{children:"rpc"})," statements."]}),"\n",(0,a.jsx)(t.p,{children:"The following example illustrates how to call a GraphQL service from Paraflow."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:'task !RegisterSeg($id) on "graphql:http://localhost:8000/graphql" {\n  let { $desc, $lat, $lon } = @getSegmentDetail($id);\n  insert segment($desc, $lat, $lon);\n}\n'})}),"\n",(0,a.jsx)(t.p,{children:"Most GraphQL requests will return data as an object, and this example demonstrates how that can be unpacked into local variables. For more detail about destructuring assignments see the Variables section."}),"\n",(0,a.jsx)(t.h2,{id:"pncp-task",children:"PNCP Task"}),"\n",(0,a.jsx)(t.p,{children:"One of two types of tasks, the PNCP task describes delegation of matching goals to the Paranet in the form of a new request."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:'<pncp-task> :=\n  "task" <goal-pattern> [ <cost-clause> ] <pncp-task-body>\n\n<pncp-task-body> :=\n  [ <using-block> ] "is"\n  "pncp" [ "let" <object-lhs> "=" ]\n  <pncp-task-request> [ "to" <expression> ]\n  <pncp-body>\n\n<pncp-task-request> :=\n  <identifier>/<identifier> [ "~" <version-spec> ] <call-bindings> |\n  "ask" <identifier> <call-bindings>\n\n<pncp-body> := "in" <statement-block> | ";"\n'})}),"\n",(0,a.jsx)(t.h3,{id:"skill-requests",children:"Skill Requests"}),"\n",(0,a.jsx)(t.p,{children:"The following is an example of a PNCP skill request task:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"task !SendMessage($message, $actor) is\n  pncp messaging/send($message) to $actor;\n"})}),"\n",(0,a.jsxs)(t.p,{children:["This task delegates ",(0,a.jsx)(t.code,{children:"!SendMessage"})," goals to the Paranet. When the planner matches a goal to this task, the corresponding skill request will be made to the Paranet. The goal will be considered complete once the skill request response is received."]}),"\n",(0,a.jsx)(t.p,{children:"Here\u2019s an example of a skill request that has a response."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"task !FetchDeviceStatus($device_id) is\n  let { $status } = pncp devices/get_status($device_id) in {\n  update devices(id == $device_id, $status);\n}\n"})}),"\n",(0,a.jsxs)(t.p,{children:["This example shows how to consume a response from a delegated task. The skill returns a status value for a given device. The left-hand side of the ",(0,a.jsx)(t.code,{children:"let"})," statement describes the expected response data. When the response is received, a ",(0,a.jsx)(t.code,{children:"$status"})," variable will be assigned the value from the response and the ",(0,a.jsx)(t.code,{children:"in"})," statement body will be executed. In this example, the ",(0,a.jsx)(t.code,{children:"update"})," statement is used to write the response to a database table."]}),"\n",(0,a.jsx)(t.h2,{id:"procedures-and-functions",children:"Procedures and Functions"}),"\n",(0,a.jsx)(t.p,{children:"Procedures and functions may be defined in order to reuse code in multiple events, rules, or tasks. Parameters are defined with types in the same way as event parameters."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:'<function> :=\n  "procedure" <identifier> <parameter-list> <statement-block> |\n  "function" <identifier> <parameter-list> <statement-block> |\n  "pure" "function" <identifier> <parameter-list> <statement-block>\n'})}),"\n",(0,a.jsx)(t.p,{children:"A procedure must not return a value. Functions and pure functions must return a value. Pure functions must not access any external data, i.e., the return value from a pure function for a given set of input values is always the same."})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>i});var a=n(6540);const s={},r=a.createContext(s);function l(e){const t=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),a.createElement(r.Provider,{value:t},e.children)}}}]);