<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-paraflow/tables" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Tables | Paranet Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.paranet.ai/img/paranet_logo.svg"><meta data-rh="true" name="twitter:image" content="https://docs.paranet.ai/img/paranet_logo.svg"><meta data-rh="true" property="og:url" content="https://docs.paranet.ai/paraflow/tables"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Tables | Paranet Documentation"><meta data-rh="true" name="description" content="Paraflow programs can define and manipulate application tables that are stored in a database, as well as small in-memory tables represented by a local variable. The language provides statements for creating, deleting, updating, and querying tables."><meta data-rh="true" property="og:description" content="Paraflow programs can define and manipulate application tables that are stored in a database, as well as small in-memory tables represented by a local variable. The language provides statements for creating, deleting, updating, and querying tables."><link data-rh="true" rel="icon" href="/img/paranet_favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.paranet.ai/paraflow/tables"><link data-rh="true" rel="alternate" href="https://docs.paranet.ai/paraflow/tables" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.paranet.ai/paraflow/tables" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.b116edeb.css">
<script src="/assets/js/runtime~main.9f100a16.js" defer="defer"></script>
<script src="/assets/js/main.a8b5a01a.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/paranet_logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/paranet_logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Docs</b></a><a class="navbar__item navbar__link" href="/getting_started">Getting Started</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/paraflow">Paraflow</a><a class="navbar__item navbar__link" href="/developer_tools">Developer Tools</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/getting_started">Getting Started</a><button aria-label="Expand sidebar category &#x27;Getting Started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/paraflow">Paraflow</a><button aria-label="Collapse sidebar category &#x27;Paraflow&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paraflow/hello-world">Hello World</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paraflow/language-basics">Language Basics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paraflow/top-level">Top Level</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paraflow/variables">Variables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paraflow/control_flow">Control Flow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/paraflow/tables">Tables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paraflow/bindings">Bindings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paraflow/runtime_internals">Runtime Internals</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paraflow/debugging">Debugger</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/developer_tools">Developer Tools</a><button aria-label="Expand sidebar category &#x27;Developer Tools&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/paraflow"><span itemprop="name">Paraflow</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Tables</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Tables</h1></header>
<p>Paraflow programs can define and manipulate application tables that are stored in a database, as well as small in-memory tables represented by a local variable. The language provides statements for creating, deleting, updating, and querying tables.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="queries">Queries<a href="#queries" class="hash-link" aria-label="Direct link to Queries" title="Direct link to Queries">​</a></h2>
<p>The query part of statements such as <code>with</code> or <code>foreach</code> describe a list of tables, constraints, and outputs as follows:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;simple-query&gt; := &lt;select-clause&gt; {&quot;,&quot; &lt;select-clause&gt;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;select-clause&gt; :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;identifier&gt; &quot;(&quot; &lt;table-binding&gt; {&quot;,&quot; &lt;table-binding&gt;} &quot;)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;table-binding&gt; :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;variable&gt; |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;column&gt; &quot;:&quot; &lt;variable&gt; |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;column&gt; &lt;relation&gt; &lt;expression&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;column&gt; &quot;~&quot; &lt;expression&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;relation&gt; := &quot;==&quot; | &quot;&lt;&gt;&quot; | &quot;&lt;&quot; | &quot;&lt;=&quot; | &quot;&gt;&quot; | &quot;&gt;=&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  order(id == $order_id, $date, total: $order_total)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This query would match rows in the <code>order</code> table that have an <code>id</code> column equal to the value of the <code>$order_id</code> variable. The <code>$date</code> binding is a shorthand that binds the value of the column by the same name (without the dollar sign) to the variable <code>$data</code>. The <code>total</code> binding binds the value of the <code>total</code> column to the variable <code>$order_total</code>. For each row matching the constraint, the <code>$date</code> and <code>$order_total</code> variables will be assigned the values of the corresponding columns in the row before executing the body part of a statement containing the query.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="joins">Joins<a href="#joins" class="hash-link" aria-label="Direct link to Joins" title="Direct link to Joins">​</a></h3>
<p>Queries may involve multiple tables, resulting in a join query. For example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  customer(id == $customer_id, $last_order), order(id == $last_order, $total)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This query would find rows in the <code>customer</code> table that match the <code>id</code> constraint, and for each row, it matches rows in the <code>order</code> table whose <code>id</code> matches the current customer row’s <code>last_order</code> column. Outputs from the first table query are available to use as constraints in subsequent table queries, such as <code>$last_order</code> in this example.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="with-statement">With Statement<a href="#with-statement" class="hash-link" aria-label="Direct link to With Statement" title="Direct link to With Statement">​</a></h2>
<p>The <code>with</code> statement is used to fetch a single row or aggregate rows from a table.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;with-statement&gt; :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;with&quot; [ &quot;unique&quot; ] &lt;simple-query&gt; &lt;*-stmt-block&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [ &quot;else&quot; &lt;*-stmt-block&gt; &quot;;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note that the <code>with</code> statement may appear in events, rules, and tasks, which each have specific allowed statements, so <code>*-stmt-block</code> corresponds to the appropriate block for whatever context it appears in, i.e., <code>event-stmt-block</code>, <code>rule-stmt-block</code>, or <code>task-stmt-block</code>.</p>
<p>For example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">with order(id == $order_id, $date, total: $order_total) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if $order_total &gt;= 1000 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    !AuthorizeLargeOrder(id -&gt; $order_id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>with</code> statement is executed by querying the table for rows matching the simple query constraints. The values of the first matching row are used to initialize the output variables declared in the simple query. The block statement is then executed with these variables defined.</p>
<p>If there are no matching rows and there is an <code>else</code> part, then that block statement will be executed. It is an error if there are no matching rows and the statement does not include an <code>else</code> part. It is also an error if the <code>unique</code> keyword is present and more than one row matches.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="aggregation">Aggregation<a href="#aggregation" class="hash-link" aria-label="Direct link to Aggregation" title="Direct link to Aggregation">​</a></h3>
<p>The <code>with</code> statement can also be used to aggregate columns in a table. For example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">with order_item(order_id == $order_id, sum(amount): $order_total) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">⋮</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This example returns the sum of the <code>amount</code> column over all rows with a matching <code>order_id</code>. Supported aggregate operators include: <code>min</code>, <code>max</code>, <code>avg</code>, <code>sum</code>, <code>count</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="loop-statement">Loop Statement<a href="#loop-statement" class="hash-link" aria-label="Direct link to Loop Statement" title="Direct link to Loop Statement">​</a></h2>
<p>The <code>foreach</code> statement is used to iterate over any number of rows in a table.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;loop-statement&gt; :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;foreach&quot; [ &quot;distinct&quot; ] &lt;simple-query&gt; &lt;*-stmt-block&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note that the <code>foreach</code> statement may appear in events, rules, and tasks, which each have specific allowed statements, so <code>*-stmt-block</code> corresponds to the appropriate block for whatever context it appears in, i.e., <code>event-stmt-block</code>, <code>rule-stmt-block</code>, or <code>task-stmt-block</code>.</p>
<p>For example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">foreach user_group(id == $target, $user) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  !SendReport($report, $user);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This example creates a new <code>!SendReport</code> goal for each user in the <code>user_group</code> table with the matching <code>id</code> in <code>$target</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="loop-body-variables">Loop Body Variables<a href="#loop-body-variables" class="hash-link" aria-label="Direct link to Loop Body Variables" title="Direct link to Loop Body Variables">​</a></h3>
<p>Variables first defined within the loop body remain local to that statement block. However, if a variable is defined before the loop and is updated within the loop body, then it will retain its updated value after the loop. In the following example, the variable will have the total number of unsent messages outside the loop.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">let $unsent = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foreach message(from == $id, $sent) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if not $sent {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let $unsent = $unsent + 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return { $unsent };</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="insert-statement">Insert Statement<a href="#insert-statement" class="hash-link" aria-label="Direct link to Insert Statement" title="Direct link to Insert Statement">​</a></h2>
<p>The <code>insert</code> statement is used to insert a new row into a table.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;insert-expression&gt; :=  &quot;insert&quot; &lt;identifier&gt; &quot;(&quot; &lt;insert-binding&gt; {&quot;,&quot; &lt;insert-binding&gt;} &quot;)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;insert-binding&gt; :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;variable&gt; |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;column&gt; &quot;:&quot; &lt;expression&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For example:</p>
<p>insert bug($title, open: 1);</p>
<p>The arguments are the column name followed by an expression value for each column. Variable references are shorthand for providing the variable&#x27;s value for the column with the same name, i.e., <code>$target</code> in the example is shorthand for <code>target: $target</code>.</p>
<p>The <code>insert</code> statement may also be used as the right-hand side of an assignment, in which case it returns the <code>id</code> of the new row:</p>
<p>let $row_id = insert bug($title, open: 1);</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="update-statement">Update Statement<a href="#update-statement" class="hash-link" aria-label="Direct link to Update Statement" title="Direct link to Update Statement">​</a></h2>
<p>The <code>update</code> statement is used to update rows of a table.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;update-statement&gt; :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;update&quot; &lt;identifier&gt; &quot;(&quot; &lt;update-binding&gt; {&quot;,&quot; &lt;update-binding&gt;} &quot;)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;update-binding&gt; :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;variable&gt; |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;variable&gt; &quot;?&quot; |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;column&gt; &quot;:&quot; &lt;expression&gt; |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;column&gt; &quot;:&quot; &quot;incrBy&quot; &quot;(&quot; &lt;expression&gt; &quot;)&quot; |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;column&gt; &quot;:&quot; &quot;decrBy&quot; &quot;(&quot; &lt;expression&gt; &quot;)&quot; |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;column&gt; &quot;:&quot; &quot;append&quot; &quot;(&quot; &lt;expression&gt; &quot;)&quot; |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;column&gt; &lt;relation&gt; &lt;expression&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;column&gt; &quot;~&quot; &lt;expression&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>update</code> statement will update all rows that match the constraints in the <code>update</code> binding, replacing values of columns with the expressions provided in the <code>update</code> binding.</p>
<p>The following predefined functions have special meaning in the <code>update</code> binding:</p>
<ul>
<li><code>incrBy</code>: Adds the numeric value of the expression to the current value of the column.</li>
<li><code>decrBy</code>: Subtracts the numeric value of the expression to the current value of the column.</li>
<li><code>append</code>: Appends the string value of the expression to the current value of the column.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="conditional-update">Conditional Update<a href="#conditional-update" class="hash-link" aria-label="Direct link to Conditional Update" title="Direct link to Conditional Update">​</a></h3>
<p>The <code>update</code> statement also supports conditionally updating a column with the <code>&lt;variable&gt; &quot;?&quot;</code> syntax. When this syntax is used, the column will only be updated if the variable is defined and not null. In the following example, the columns <code>a</code> and <code>b</code> are conditionally updated.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">event setOverride($id int, $a optional string, $b optional string) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  update item(id == $id, $a?, $b?);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The column <code>a</code> is only updated if the <code>$a</code> parameter is provided and not null. Likewise, column <code>b</code> is only updated if the <code>$b</code> parameter is provided and not null. The behavior is equivalent to the following tedious code:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">event setOverride($id int, $a optional string, $b optional string) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if $a and $b {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    update item(id == $id, $a, $b);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  } else if $a {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    update item(id == $id, $a);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  } else if $b {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    update item(id == $id, $b);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note that this example is not equivalent to the following update, which would set the <code>a/b</code> columns to null if <code>a/b</code> were not provided.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">update item(id == $id, $a, $b);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="delete-statement">Delete Statement<a href="#delete-statement" class="hash-link" aria-label="Direct link to Delete Statement" title="Direct link to Delete Statement">​</a></h2>
<p>This statement deletes rows from a table that match the given constraints.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;delete-statement&gt; :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;delete&quot; &lt;identifier&gt; &quot;(&quot; &lt;delete-binding&gt; {&quot;,&quot; &lt;delete-binding&gt;} &quot;)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;delete-binding&gt; :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;column&gt; &lt;relation&gt; &lt;expression&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;column&gt; &quot;~&quot; &lt;expression&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="local-tables">Local Tables<a href="#local-tables" class="hash-link" aria-label="Direct link to Local Tables" title="Direct link to Local Tables">​</a></h2>
<p>Local variables may represent in-memory tables and can be used in the same way as a database table. Local tables may appear as parameters to events, they may be returned from a PNCP skill request or RPC method, and they may be created locally. The following examples illustrate various uses of local tables.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="event-parameters">Event Parameters<a href="#event-parameters" class="hash-link" aria-label="Direct link to Event Parameters" title="Direct link to Event Parameters">​</a></h3>
<p>This example illustrates how to use a table event parameter.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">event removeItems($items: table(sku string)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  foreach $items($sku) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    delete products(sku == $sku);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The event expects the <code>items</code> input to be an array of objects having a <code>sku</code> string field. The body loops over each row in the local table and deletes the corresponding row in a database table.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="skill-request">Skill Request<a href="#skill-request" class="hash-link" aria-label="Direct link to Skill Request" title="Direct link to Skill Request">​</a></h3>
<p>A skill request may return arrays of data that can be bound to a local variable and used as a table. This example illustrates the use of a table returned by a skill request.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">task !FetchUpdates($last_fetch) is</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pncp let {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    transactions: $updates(timestamp, description, amount)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  } = transactions/new_since(time -&gt; $last_fetch) in {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    foreach $updates($timestamp, $description, $amount) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      insert shadow($timestamp, $description, $amount);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example, there is an actor that maintains a store of transactions and a skill for querying transactions created since a given time. Its response has a <code>transactions</code> field that is an array of transaction objects. Each transaction object has a <code>timestamp</code>, <code>description</code>, and <code>amount</code>. The <code>let</code> statement is used to capture the response <code>transactions</code> into the local table variable <code>$updates</code>.</p>
<p>The local table variable is used in the “in” block to update a local shadow database with the transactions in the local table.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="select-expressions">Select Expressions<a href="#select-expressions" class="hash-link" aria-label="Direct link to Select Expressions" title="Direct link to Select Expressions">​</a></h3>
<p>The <code>select</code> expression can be used to select and transform data from a database table and store the resulting rows in a local table variable.</p>
<p>One useful use case for creating a local table is to return tabular data from a skill request. Consider implementing the <code>transactions/new_since</code> skill from the example in the previous section. That skill might be implemented as in:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">task !SendNewSince($time) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let $transactions(timestamp, description, amount) = </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   select transaction_tbl(timestamp &gt; $time, timestamp, description, amount);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pncp response($transactions);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="local-creation">Local Creation<a href="#local-creation" class="hash-link" aria-label="Direct link to Local Creation" title="Direct link to Local Creation">​</a></h3>
<p>Another way to create a local table is from scratch. This is one way to easily filter and transform data before using it. The following example illustrates local table creation.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">event getActive($threshold double) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let $active(*) = table();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  foreach location_tbl($id, $activity, $easting, $northing) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if $activity &gt; $threshold {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let { $lat, $lon } = ToGPS($easting, $northing);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      insert $active($id, $lat, $lon);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return { $active };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/your-org/your-project/edit/main/paranet/paraflow/tables.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/paraflow/control_flow"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Control Flow</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/paraflow/bindings"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Bindings</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#queries" class="table-of-contents__link toc-highlight">Queries</a><ul><li><a href="#joins" class="table-of-contents__link toc-highlight">Joins</a></li></ul></li><li><a href="#with-statement" class="table-of-contents__link toc-highlight">With Statement</a><ul><li><a href="#aggregation" class="table-of-contents__link toc-highlight">Aggregation</a></li></ul></li><li><a href="#loop-statement" class="table-of-contents__link toc-highlight">Loop Statement</a><ul><li><a href="#loop-body-variables" class="table-of-contents__link toc-highlight">Loop Body Variables</a></li></ul></li><li><a href="#insert-statement" class="table-of-contents__link toc-highlight">Insert Statement</a></li><li><a href="#update-statement" class="table-of-contents__link toc-highlight">Update Statement</a><ul><li><a href="#conditional-update" class="table-of-contents__link toc-highlight">Conditional Update</a></li></ul></li><li><a href="#delete-statement" class="table-of-contents__link toc-highlight">Delete Statement</a></li><li><a href="#local-tables" class="table-of-contents__link toc-highlight">Local Tables</a><ul><li><a href="#event-parameters" class="table-of-contents__link toc-highlight">Event Parameters</a></li><li><a href="#skill-request" class="table-of-contents__link toc-highlight">Skill Request</a></li><li><a href="#select-expressions" class="table-of-contents__link toc-highlight">Select Expressions</a></li><li><a href="#local-creation" class="table-of-contents__link toc-highlight">Local Creation</a></li></ul></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>